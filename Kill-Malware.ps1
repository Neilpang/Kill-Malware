<#
.SYNOPSIS  
all malware go to hell!

.DESCRIPTION
run this script will lead your PC to unable to smoothly install the some malwares 
if you mind , don't run it . 

.EXAMPLE
.\Kill-Malware.ps1 (runas admin)

.NOTES
author:Vizo
date:  2017/2/28

.LINK
source project:https://liwei2.com/2015/11/27/378.html
latest project:
#>

# run as admin 
# $currentWi = [Security.Principal.WindowsIdentity]::GetCurrent()
# $currentWp = [Security.Principal.WindowsPrincipal]$currentWi
# if( -not $currentWp.IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)){
#     $boundPara = ($MyInvocation.BoundParameters.Keys | foreach{
#         '-{0} {1}' -f  $_ ,$MyInvocation.BoundParameters[$_]} ) -join ' '
#     $currentFile = (Resolve-Path  $MyInvocation.InvocationName).Path
#     $fullPara = $boundPara + ' ' + $args -join ' '
#     Start-Process "$psHome\powershell.exe"   -ArgumentList "$currentFile $fullPara" -verb runas
#     return
# }

$PSScriptRoot
$program = "C:\Program Files"
$programx86 = "C:\Program Files (x86)"
$appdata = Get-Childitem env:APPDATA | %{ $_.Value } 
<# firstly I write so stupid
$fileList = Get-ChildItem "$PSScriptRoot\CA\"  *.cer | %{$_.Name} | Out-File "$PSScriptRoot\CAlisttmp.txt"
$lineNum =  (Get-Content "$PSScriptRoot\CAlisttmp.txt").Length
for($i=0;$i -lt $lineNum;$i++){
    $currentLineName=(Get-Content "$PSScriptRoot\CAlisttmp.txt" -TotalCount $lineNum)[-($lineNum)+$i]
    certutil -f -addstore -user “Disallowed” "$PSScriptRoot\CA\$currentLineName"
}
#>

# block digital certificate
# ForEach($file in Dir "$PSScriptRoot\CA"){
#     certutil -f -addstore -user “Disallowed” "$PSScriptRoot\CA\$file"
# }

# set directory permissions
# Baidu 
Write-Host "" -ForegroundColor Red
New-Item "$program\Baidu\BaiduAn" -ItemType Directory
New-Item "$program\Baidu\BaiduSd" -ItemType Directory
New-Item "$appdata\Baidu"
cacls "$program\Baidu\BaiduAn" /e /d Everyone
cacls "$program\Baidu\BaiduSd" /e /d Everyone
cacls "$appdata\Baidu" /e /d Everyone
for($i = 1;$i -le 9;$i++ ){
     for($j = 0;$j -le 9; $j++ ){
         New-Item "$program\BaiduSd$i.$j" -ItemType Directory
         attrib +s +h "$program\BaiduSd$i.$j"
         cacls "$program\BaiduSd$i.$j" /e /d Everyone
     }
}
New-Item "$programx86\Baidu\BaiduAn" -ItemType Directory
New-Item "$programx86\Baidu\BaiduSd" -ItemType Directory
for($i = 1;$i -le 9;$i++ ){
     for($j = 0;$j -le 9; $j++ ){
         New-Item "$programx86\BaiduSd$i.$j" -ItemType Directory
         attrib +s +h "$programx86\BaiduSd$i.$j"
         cacls "$programx86\BaiduSd$i.$j" /e /d Everyone
     }
}

# QiHoo 360
Write-Host "" -ForegroundColor Red
New-Item "$program\360\360safe" -ItemType Directory
New-Item "$program\360\360sd" -ItemType Directory
cacls "$program\360\360safe" /e /d Everyone
cacls "$program\360\360sd" /e /d Everyone
New-Item "$programx86\360\360safe" -ItemType Directory
New-Item "$programx86\360\360sd" -ItemType Directory
cacls "%ProgramFiles(x86)%\360\360safe" /e /d Everyone
cacls "%ProgramFiles(x86)%\360\360sd" /e /d Everyone

# Kingsoft
Write-Host "" -ForegroundColor Red
New-Item "$program\ksafe" -ItemType Directory
New-Item "$program\kingsoft\kingsoft antivirus" -ItemType Directory
cacls "$program\ksafe" /e /d Everyone
cacls "$program\kingsoft\kingsoft antivirus" /e /d Everyone
New-Item "$programx86\ksafe" -ItemType Directory
New-Item "$programx86\kingsoft\kingsoft antivirus" -ItemType Directory
cacls "$programx86\ksafe" /e /d Everyone
cacls "$programx86\kingsoft\kingsoft antivirus" /e /d Everyone

# Tencent 
Write-Host "" -ForegroundColor Red
New-Item "$program\Tencent\QQPCMgr" -ItemType Directory
New-Item "$appdata\Tencent\QQPCMgr" -ItemType Directory
cacls "$program\Tencent\QQPCMgr" /e /d Everyone
cacls "$appdata\Tencent\QQPCMgr" /e /d Everyone
New-Item "$programx86\Tencent\QQPCMgr"  -ItemType Directory
cacls    "$programx86\Tencent\QQPCMgr" /e /d Everyone

# Rising
Write-Host "" -ForegroundColor Red
New-Item "$program\Rising" -ItemType Directory
New-Item "$program\Rising\Rav" -ItemType Directory
cacls "$program\Rising\Rav" /e /d Everyone
cacls "$program\Rising" /e /d Everyone
New-Item "$programx86\Rising" -ItemType Directory
New-Item "$programx86\Rising\Rav" -ItemType Directory
cacls "$programx86\Rising\Rav" /e /d Everyone
cacls "$programx86\Rising" /e /d Everyone


# block IP and URL
#Get-content "$PSScriptRoot\latestBlockhosts.txt" | Add-content "C:\Windows\System32\drivers\etc\hosts" -Force



