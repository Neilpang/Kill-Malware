@echo off
:: BatchGotAdmin  
:-------------------------------------  
REM  --> Check for permissions  
>nul 2>&1 "%SYSTEMROOT%\system32\cacls.exe" "%SYSTEMROOT%\system32\config\system"  
  
REM --> If error flag set, we do not have admin.  
if '%errorlevel%' NEQ '0' (  
    echo Requesting administrative privileges...  
    goto UACPrompt  
) else ( goto gotAdmin )  
  
:UACPrompt  
    echo Set UAC = CreateObject^("Shell.Application"^) > "%temp%\getadmin.vbs"  
    echo UAC.ShellExecute "%~s0", "", "", "runas", 1 >> "%temp%\getadmin.vbs"  
  
    "%temp%\getadmin.vbs"  
    exit /B  
  
:gotAdmin  
    if exist "%temp%\getadmin.vbs" ( del "%temp%\getadmin.vbs" )  
    pushd "%CD%"  
    CD /D "%~dp0"  
:--------------------------------------  
set host=%systemroot%\system32\drivers\etc\hosts
set prog=%ProgramFiles%
echo %processor_architecture%|find "64"
::是否是64位系统 AR=y
if %errorlevel% equ 0 set AR=y
cls
title 一键恢复脚本&color 0a
echo.
echo 運行此腳本之後，將會恢復所有遮罩操作。
echo 請使用管理員許可權運行！
echo 程式集目錄：%prog%
echo.
pause
echo 正在恢復hosts...
echo 127.0.0.1 localhost>%host%
echo 正在設定目錄許可權...
cacls "%prog%\360\360safe" /E /G Everyone:F
cacls "%prog%\360\360sd" /E /G Everyone:F
cacls "%prog%\Baidu\BaiduAn" /E /G Everyone:F
cacls "%prog%\Baidu\BaiduSd" /E /G Everyone:F
cacls "%appdata%\Baidu" /E /G Everyone:F
for /l %%i in (1,1,9) do (
	for /l %%j in (0,1,9) do (
	cacls "%prog%\BaiduSd%%i.%%j" /E /G Everyone:F
	attrib -s -h "%prog%\BaiduSd%%i.%%j"
	rmdir /s /q "%prog%\BaiduSd%%i.%%j"
    )
)
cacls "%prog%\ksafe" /E /G Everyone:F
cacls "%prog%\kingsoft\kingsoft antivirus" /E /G Everyone:F
cacls "%prog%\Tencent\QQPCMgr" /E /G Everyone:F
cacls "%appdata%\Tencent\QQPCMgr" /E /G Everyone:F
cacls "%prog%\Rising\Rav" /E /G Everyone:F
cacls "%prog%\Rising" /E /G Everyone:F
cacls "%prog%\Tencent\TPhelper" /E /G Everyone:F
::删除这些目录
rmdir /s /q "%prog%\ksafe"
rmdir /s /q "%prog%\kingsoft\"
rmdir /s /q "%prog%\Tencent\QQPCMgr"
rmdir /s /q "%appdata%\Tencent\QQPCMgr"
rmdir /s /q "%prog%\Rising"
rmdir /s /q "%prog%\Tencent\TPhelper"
rmdir /s /q "%appdata%\Baidu"
rmdir /s /q "%prog%\Baidu"
rmdir /s /q "%prog%\360"

::---------------------------------------------------------------------------------------
if "%AR%"=="y" (
cacls "%ProgramFiles(x86)%\360\360safe" /E /G Everyone:F
cacls "%ProgramFiles(x86)%\360\360sd" /E /G Everyone:F
cacls "%ProgramFiles(x86)%\Baidu\BaiduAn" /E /G Everyone:F
cacls "%ProgramFiles(x86)%\Baidu\BaiduSd" /E /G Everyone:F
for /l %%i in (1,1,9) do (
	for /l %%j in (0,1,9) do (
	cacls "%ProgramFiles(x86)%\BaiduSd%%i.%%j" /E /G Everyone:F
	attrib -s -h "%ProgramFiles(x86)%\BaiduSd%%i.%%j"
	rmdir /s /q "%ProgramFiles(x86)%\BaiduSd%%i.%%j"
    )
)
cacls "%ProgramFiles(x86)%\ksafe" /E /G Everyone:F
cacls "%ProgramFiles(x86)%\kingsoft\kingsoft antivirus" /E /G Everyone:F
cacls "%ProgramFiles(x86)%\Tencent\QQPCMgr" /E /G Everyone:F
cacls "%ProgramFiles(x86)%\Rising\Rav" /E /G Everyone:F
cacls "%ProgramFiles(x86)%\Rising" /E /G Everyone:F
cacls "%ProgramFiles(x86)%\Tencent\TPhelper" /E /G Everyone:F
::删除这些目录
rmdir /s /q "%ProgramFiles(x86)%\ksafe"
rmdir /s /q "%ProgramFiles(x86)%\kingsoft\"
rmdir /s /q "%ProgramFiles(x86)%\Tencent\QQPCMgr"
rmdir /s /q "%ProgramFiles(x86)%\Rising"
rmdir /s /q "%ProgramFiles(x86)%\Tencent\TPhelper"
rmdir /s /q "%ProgramFiles(x86)%\Baidu"
rmdir /s /q "%ProgramFiles(x86)%\360"
)
echo 正在清空註冊表證書限制策略…
reg delete "HKEY_CURRENT_USER\Software\Microsoft\SystemCertificates\Disallowed\Certificates" /f
(
echo 操作完毕！
)|msg * 