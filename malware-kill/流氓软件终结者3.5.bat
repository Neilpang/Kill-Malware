@ECHO OFF
:: BatchGotAdmin  
:-------------------------------------  
REM  --> Check for permissions  
>nul 2>&1 "%SYSTEMROOT%\system32\cacls.exe" "%SYSTEMROOT%\system32\config\system"  
  
REM --> If error flag set, we do not have admin.  
if '%errorlevel%' NEQ '0' (  
    echo Requesting administrative privileges...  
    goto UACPrompt  
) else ( goto gotAdmin )  
  
:UACPrompt  
    echo Set UAC = CreateObject^("Shell.Application"^) > "%temp%\getadmin.vbs"  
    echo UAC.ShellExecute "%~s0", "", "", "runas", 1 >> "%temp%\getadmin.vbs"  
  
    "%temp%\getadmin.vbs"  
    exit /B  
  
:gotAdmin  
    if exist "%temp%\getadmin.vbs" ( del "%temp%\getadmin.vbs" )  
    pushd "%CD%"  
    CD /D "%~dp0"  
:--------------------------------------  
cd %~dp0&chcp 936
set host=%systemroot%\system32\drivers\etc\hosts
set selects=choice /M
set prog=%ProgramFiles%
echo %processor_architecture%|find "64"
if %errorlevel% equ 0 set AR=y
title 流氓软件终结者3.5&color 0a&cls
 echo                ----☆☆☆流氓软件终结者☆☆☆----
 echo  ┌─────────┬────────┬────────┐
 echo  │      百度杀毒    │　   百度卫士   │   360安全卫士  │
 echo  ├─────────┼────────┼────────┤
 echo  │      360杀毒     │　   QQ电脑管家 │   瑞星杀毒软件 │
 echo  ├─────────┼────────┼────────┤
 echo  │      金山毒霸    │　   金山卫士   │腾讯游戏安全中心│
 echo  └─────────┴────────┴────────┘
:: 1 XP;2 XP Up;0 Under Xp
ver|findstr "5\.[0-9]\.[0-9][0-9]*">nul&&(set isxp=1&goto nextstep)
ver|findstr "6\.[0-9]\.[0-9][0-9]*">nul&&(set isxp=2&goto nextstep)
set isxp=0
:nextstep
echo.
echo 本批处理可以自由的选择屏蔽，并支持WinXP操作系统
echo Win7及以上操作系统运行前请确保完全解压并使用管理员权限执行！
echo 批处理将会屏蔽其下载地址、证书、安装目录
echo 如果遇到问题您可以使用本目录下的一键恢复脚本
echo 祝使用愉快！ via https://liwei2.com
echo.


if %isxp% equ 2 (
    echo 操作系统：Win7/Win8/Win8.1/Win10
) else (
    echo 操作系统：WinXP/Win2003
    echo 设置证书限制策略为打开...
    reg import "certificate\Tools\WinXP_Enable.reg"
)
echo.

%selects% ">确认屏蔽百度杀毒与百度卫士？"
if %errorlevel% equ 1 (
::如果唔系Win7的咁话仅屏蔽证书，因WinXP唔支持cacls
    if %isxp% equ 1 goto cert_bd
    :begin_BD
    echo 正在屏蔽其目录...
    mkdir "%prog%\Baidu\BaiduAn"
    mkdir "%prog%\Baidu\BaiduSd"
    mkdir "%appdata%\Baidu"
    ::百度杀毒软件好无耻
    for /l %%i in (1,1,9) do (
        for /l %%j in (0,1,9) do (
            mkdir "%prog%\BaiduSd%%i.%%j"
            attrib +s +h "%prog%\BaiduSd%%i.%%j"
            cacls "%prog%\BaiduSd%%i.%%j" /e /d Everyone
        )
    )
    if "%AR%"=="y" (
        mkdir "%ProgramFiles(x86)%\Baidu\BaiduAn"
        mkdir "%ProgramFiles(x86)%\Baidu\BaiduSd"
        for /l %%i in (1,1,9) do (
            for /l %%j in (0,1,9) do (
                mkdir "%ProgramFiles(x86)%\BaiduSd%%i.%%j"
                attrib +s +h "%ProgramFiles(x86)%\BaiduSd%%i.%%j"
                cacls "%ProgramFiles(x86)%\BaiduSd%%i.%%j" /e /d Everyone
            )
        )
    )
    cacls "%prog%\Baidu\BaiduAn" /e /d Everyone
    cacls "%prog%\Baidu\BaiduSd" /e /d Everyone
    cacls "%appdata%\Baidu" /e /d Everyone
    :cert_bd
    echo 正在屏蔽百度的证书...
    reg import "certregister\BaiduAnSd.reg"
    reg import "certregister\BaiduAn1.reg"
    echo 正在屏蔽百度搜索结果中的捆绑软件的证书...
    reg import "certregister\BaiduDown.reg"
    echo 屏蔽百度软件下载地址会导致搜索结果中的软件无法下载...跳过屏蔽
    echo.
)

%selects% ">确认屏蔽360安全卫士与360杀毒？"
if %errorlevel% equ 1 (
::如果唔系Win7的咁话仅屏蔽证书，因WinXP唔支持cacls
    if %isxp% equ 1 goto cert_qihu
    echo 正在屏蔽其目录...
    mkdir "%prog%\360\360safe"
    mkdir "%prog%\360\360sd"
    cacls "%prog%\360\360safe" /e /d Everyone
    cacls "%prog%\360\360sd" /e /d Everyone
    if "%AR%"=="y" (
        mkdir "%ProgramFiles(x86)%\360\360safe"
        mkdir "%ProgramFiles(x86)%\360\360sd"
        cacls "%ProgramFiles(x86)%\360\360safe" /e /d Everyone
        cacls "%ProgramFiles(x86)%\360\360sd" /e /d Everyone
    )
    :cert_qihu
    echo 正在屏蔽360安全卫士和360杀毒的证书...
    reg import "certregister\360inst.reg"
    echo 正在屏蔽360安全卫士（超强版）的证书...
    reg import "certregister\360_safe_cq.reg"
    echo 正在屏蔽360「安全」软件的下载地址...
    echo 127.0.0.1 down.360.cn>>%host%
    echo 127.0.0.1 dl.360safe.com>>%host%
    echo 屏蔽命令已发送！
    echo.
)

%selects% ">确认屏蔽金山卫士和金山毒霸？"
if %errorlevel% equ 1 (
::如果唔系Win7的咁话仅屏蔽证书，因WinXP唔支持cacls
    if %isxp% equ 1 goto cert_kingsoft
    echo 正在屏蔽其目录...
    mkdir "%prog%\ksafe"
    mkdir "%prog%\kingsoft\kingsoft antivirus"
    cacls "%prog%\ksafe" /e /d Everyone
    cacls "%prog%\kingsoft\kingsoft antivirus" /e /d Everyone
    if "%AR%"=="y" (
        mkdir "%ProgramFiles(x86)%\ksafe"
        mkdir "%ProgramFiles(x86)%\kingsoft\kingsoft antivirus"
        cacls "%ProgramFiles(x86)%\ksafe" /e /d Everyone
        cacls "%ProgramFiles(x86)%\kingsoft\kingsoft antivirus" /e /d Everyone
    )
    :cert_kingsoft
    echo 正在屏蔽金山卫士的证书...
    reg import "certregister\KingSoftWs.reg"
    reg import "certregister\KingSoftWs1.reg"
    echo 正在屏蔽金山毒霸的证书...
    reg import "certregister\KingSoftDb.reg"
    echo 正在屏蔽金山「安全」软件的下载地址...
    echo 127.0.0.1 dl.ijinshan.com>>%host%
    echo 127.0.0.1 cd001.www.duba.net>>%host%
    echo 127.0.0.1 cd002.www.duba.net>>%host%
    echo 127.0.0.1 cd003.www.duba.net>>%host%
    echo 127.0.0.1 cd004.www.duba.net>>%host%
    echo 127.0.0.1 cd005.www.duba.net>>%host%
    echo 127.0.0.1 cd006.www.duba.net>>%host%
    echo 127.0.0.1 cd007.www.duba.net>>%host%
    echo 127.0.0.1 cd008.www.duba.net>>%host%
    echo 127.0.0.1 cd009.www.duba.net>>%host%
    echo 127.0.0.1 cd010.www.duba.net>>%host%
    echo 127.0.0.1 cd011.www.duba.net>>%host%
    echo 127.0.0.1 cd012.www.duba.net>>%host%
    echo 屏蔽命令已发送！
    echo.
)

%selects% ">确认屏蔽QQ电脑管家？"
if %errorlevel% equ 1 (
::QQ电脑管家软件的证书同QQ，故不屏蔽
    if %isxp% equ 1 goto cert_qqpcmgr
    echo 正在屏蔽其目录...
    mkdir "%prog%\Tencent\QQPCMgr"
    mkdir "%appdata%\Tencent\QQPCMgr"
    cacls "%prog%\Tencent\QQPCMgr" /e /d Everyone
    cacls "%appdata%\Tencent\QQPCMgr" /e /d Everyone
        if "%AR%"=="y" (
            mkdir "%ProgramFiles(x86)%\Tencent\QQPCMgr"
            cacls "%ProgramFiles(x86)%\Tencent\QQPCMgr" /e /d Everyone
        )
    echo QQ电脑管家软件的证书同QQ...跳过屏蔽
    echo QQ电脑管家软件的下载地址同QQ...跳过屏蔽
    echo.
)

%selects% ">确认屏蔽瑞星杀毒软件？"
if %errorlevel% equ 1 (
::如果唔系Win7的咁话仅屏蔽证书，因WinXP唔支持cacls
    if %isxp% equ 1 goto cert_rising
    echo 正在屏蔽其目录...
    mkdir "%prog%\Rising"
    mkdir "%prog%\Rising\Rav"
    cacls "%prog%\Rising\Rav" /e /d Everyone
    cacls "%prog%\Rising" /e /d Everyone
        if "%AR%"=="y" (
            mkdir "%ProgramFiles(x86)%\Rising"
            mkdir "%ProgramFiles(x86)%\Rising\Rav"
            cacls "%ProgramFiles(x86)%\Rising\Rav" /e /d Everyone
            cacls "%ProgramFiles(x86)%\Rising" /e /d Everyone
        )
    :cert_rising
    echo 正在屏蔽瑞星杀毒软件的证书...
    reg import "certregister\Rising.reg"
    reg import "certregister\Rising1.reg"
    echo 正在屏蔽瑞星杀毒软件的下载地址...
    echo 127.0.0.1 rsdownload.rising.com.cn>>%host%
    echo 127.0.0.1 download.rising.com.cn>>%host%
    echo 屏蔽命令已发送！
    echo.
)

%selects% ">确认屏蔽腾讯游戏安全中心？"
if %errorlevel% equ 1 (
    echo 正在屏蔽其目录...
    mkdir "%prog%\Tencent\TPhelper"
    cacls "%prog%\Tencent\TPhelper" /e /d Everyone
    if "%AR%"=="y" (
        mkdir "%ProgramFiles(x86)%\Tencent\TPhelper"
        cacls "%ProgramFiles(x86)%\Tencent\TPhelper" /e /d Everyone
    )
    echo 屏蔽命令已发送！
)

echo.&echo.
echo CNNIC是中国互联网络信息中心。
echo 2015年，因CNNIC发走的一个中级CA被发现发走Google域名的假证书
echo 而且曾有人利用自签字的CNNIC证书对GitHub进行中间人攻击
echo 并被指攻击来源很可能与防火长城有关
echo 很多用户选择不相信CNNIC颁发的数字证书。
echo 并惹对CNNIC滥用证书颁发权的担心。
echo 2015年4月2日，Google宣告。不再承认CNNIC所颁发的证书。
echo 4月4日，继Google之后，Mozilla都宣告。不再承认CNNIC所颁发的证书。
echo 来自Wikipedia:https://zh.wikipedia.org/zh-tw/CNNIC
echo.

%selects% ">确认屏蔽CNNIC证书？"
if %errorlevel% equ 1 (
    echo 正在屏蔽CNNIC的证书...
    reg import "certregister\CNNIC.reg"
    echo 屏蔽命令已发送！
    echo.
)
echo 操作完毕，请检查输出信息！
echo 欢迎关注舞恸零一的Blog：https://liwei2.com
pause